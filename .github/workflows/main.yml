{
  "name": "main",
  "on": {
    "push": {
      "branches": [
        "**"
      ]
    }
  },
  "env": {
    "NEXT_TELEMETRY_DISABLED": 1
  },
  "jobs": {
    "Build": {
      "runs-on": "ubuntu-18.04",
      "steps": [
        {
          "name": "Checkout code repository",
          "uses": "actions/checkout@v2"
        }
      ]
    },
    "Test": {
      "runs-on": "ubuntu-18.04",
      "steps": [
        {
          "name": "Checkout code repository",
          "uses": "actions/checkout@v2"
        }
      ]
    },
    "Lint": {
      "runs-on": "ubuntu-18.04",
      "steps": [
        {
          "name": "Checkout code repository",
          "uses": "actions/checkout@v2"
        }
      ]
    },
    "Preview": {
      "runs-on": "ubuntu-18.04",
      "needs": [
        "Build"
      ],
      "steps": [
        {
          "name": "Checkout code repository",
          "uses": "actions/checkout@v2"
        }
      ]
    },
    "Release": {
      "runs-on": "ubuntu-18.04",
      "needs": [
        "Build",
        "Test",
        "Lint",
        "Preview"
      ],
      "if": "github.ref == 'refs/heads/master'",
      "steps": [
        {
          "id": "step_release_please",
          "uses": "GoogleCloudPlatform/release-please-action@v2",
          "with": {
            "token": "${{ secrets.CHANGESET_GITHUB_TOKEN }}",
            "release-type": "node",
            "package-name": "rino"
          }
        }
      ],
      "outputs": {
        "published": "${{ steps.step_release_please.outputs.release_created }}"
      }
    },
    "Deployment": {
      "runs-on": "ubuntu-18.04",
      "needs": [
        "Release"
      ],
      "if": "github.ref == 'refs/heads/master' && ( needs.Release.outputs.published == 'true' || contains(github.event.head_commit.message, '[force-deploy]') )",
      "steps": [
        {
          "name": "Checkout code repository",
          "uses": "actions/checkout@v2"
        }
      ]
    }
  }
}
